spring.application.name=FreStyle

# 本番用
spring.datasource.url=${DB_URL}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Tokyo
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASS}

# spring.datasource.url=jdbc:mysql://localhost:3306/fre_style?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Tokyo
# spring.datasource.username=root
# spring.datasource.password=

spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Hibernateがスキーマに干渉しないようにする
spring.jpa.hibernate.ddl-auto=none
# samesiteでHttpOnly Cookieの設定をするStrict/LaxだとHttpsでしかリクエストが遅れない可能性があるのでNoneに設定をする
server.servlet.session.cookie.same-site=None
# ALBからのx-forwarded-protoヘッダーでHttps化を確認する
server.forwarded-headers-strategy=FRAMEWORK


# JDBCのメタデータが取得できないため、HibernateはDialect（データベースの種類）を判別できていない 
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect

# schema.sql の自動実行（手動作成しているならなしでも良い）
spring.sql.init.mode=always
spring.sql.init.encoding=utf-8

cognito.client-id=${COGNITO_CLIENT_ID}
cognito.client-secret=${COGNITO_CLIENT_SECRET}
cognito.redirect-uri=${COGNITO_REDIRECT_URI}
cognito.token-uri=${COGNITO_TOKEN_URI}
cognito.jwk-set-uri=${COGNITO_JWK_SET_URI}

aws.access-key=${AWS_ACCESS_KEY}
aws.secret-key=${AWS_SECRET_KEY}
aws.region=${AWS_REGION}

aws.dynamodb.table-name.ai-chat=fre_style_ai_chat
aws.dynamodb.table-name.chat=fre_style_chat
aws.dynamodb.table-name.notes=fre_style_notes

# S3 ノート画像
aws.s3.note-images-bucket=${NOTE_IMAGES_BUCKET}
aws.s3.note-images-cdn-url=${NOTE_IMAGES_CDN_URL}

# SQS レポート生成キュー
aws.sqs.report-queue-url=${SQS_REPORT_QUEUE_URL:}

# ========== HikariCP接続プール最適化 ==========
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.register-mbeans=true

# ========== ロギング設定（本番向け） ==========
# Spring Security（WARN以上のみ）
logging.level.org.springframework.security=WARN
logging.level.org.springframework.security.oauth2=WARN
logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=WARN

# CORS関連のログ（WARN以上のみ）
logging.level.org.springframework.web.cors=WARN
logging.level.org.springframework.web.filter.CorsFilter=WARN
logging.level.com.example.FreStyle.config.CorsConfig=INFO
logging.level.com.example.FreStyle.config.CorsLoggingFilter=INFO

# SQLクエリログ（本番ではWARN以上のみ）
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.stat=WARN

# 処理時間計測ログ
logging.level.com.example.FreStyle.config.RequestTimingAspect=INFO


# ========== Actuator / メトリクス設定 ==========
# Actuatorエンドポイント公開
management.endpoints.web.exposure.include=health,info,metrics,prometheus

# Health check の詳細レスポンスを非表示（本番向け）
management.endpoint.health.show-details=never

# CloudWatch Metricsエクスポート
management.cloudwatch.metrics.export.namespace=FreStyle
management.cloudwatch.metrics.export.step=1m
management.cloudwatch.metrics.export.enabled=true

# Hibernateメトリクス（無効化 - CloudWatchメトリクスで代替）
spring.jpa.properties.hibernate.generate_statistics=false

# ポートをSpring Bootと同じにする場合はコメントアウト
# management.server.port=8080

# ========== AWS X-Ray設定 ==========
logging.level.com.example.FreStyle.config.XRayTracingFilter=INFO
logging.level.com.example.FreStyle.config.XRayConfig=INFO
logging.level.com.amazonaws.xray=WARN